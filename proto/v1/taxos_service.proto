syntax = "proto3";

package taxos.v1;

import "google/protobuf/timestamp.proto";

// Taxos Backend
service TaxosApi {
  // Create a new bucket
  rpc CreateBucket(CreateBucketRequest) returns (Bucket);
  // Create a new receipt
  rpc CreateReceipt(CreateReceiptRequest) returns (Receipt);
  // Retrieve a bucket by GUID
  rpc GetBucket(GetBucketRequest) returns (Bucket);
  // List all buckets
  rpc ListBuckets(ListBucketsRequest) returns (ListBucketsResponse);
  // Update a bucket's details
  rpc UpdateBucket(UpdateBucketRequest) returns (Bucket);
  // Delete a bucket by GUID
  rpc DeleteBucket(DeleteBucketRequest) returns (DeleteBucketResponse);
}

message Bucket {
  string                    guid       = 1;
  string                    name       = 2;
  google.protobuf.Timestamp created_at = 3;
  google.protobuf.Timestamp updated_at = 4;
}

message ReceiptAllocation {
  string bucket_guid = 1;
  double amount      = 2;
}

message Receipt {
  string                    guid        = 1;
  string                    vendor      = 2;
  google.protobuf.Timestamp date        = 3;
  string                    timezone    = 4;
  double                    total       = 5;
  repeated ReceiptAllocation allocations = 6;
  string                    ref         = 7;
  string                    notes       = 8;
  string                    file        = 9;
  string                    hash        = 10;
}

message CreateBucketRequest {
  string name = 1;
}

message CreateReceiptRequest {
  string                    vendor      = 1;
  google.protobuf.Timestamp date        = 2;
  string                    timezone    = 3;
  double                    total       = 4;
  repeated ReceiptAllocation allocations = 5;
  string                    ref         = 6;
  string                    notes       = 7;
  string                    hash        = 8;
}

message GetBucketRequest {
  string guid = 1;
}

message ListBucketsRequest {
  google.protobuf.Timestamp start_date    = 1;
  google.protobuf.Timestamp end_date      = 2;
  bool                      include_empty = 3;
}

message ListBucketsResponse {
  repeated BucketSummary buckets = 1;
}

message BucketSummary {
  Bucket bucket        = 1;
  double total_amount  = 2;
  int32  receipt_count = 3;
}

message UpdateBucketRequest {
  string guid = 1;
  string name = 2;
}

message DeleteBucketRequest {
  string guid = 1;
}

message DeleteBucketResponse {
  bool success = 1;
}
