FROM mcr.microsoft.com/devcontainers/base:bookworm

# Install Node.js 20
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
  && apt-get install -y nodejs \
  && apt-get clean && rm -rf /var/lib/apt/lists/*

# Create vscode user directories
RUN mkdir -p /home/vscode/.local/bin && chown -R vscode:vscode /home/vscode

USER vscode

# Install Buf
RUN curl -sSL \
  "https://github.com/bufbuild/buf/releases/download/v1.34.0/buf-Linux-x86_64" \
  -o ~/.local/bin/buf \
  && chmod +x ~/.local/bin/buf

# Install grpcurl
RUN curl -sSL \
  https://github.com/fullstorydev/grpcurl/releases/download/v1.9.1/grpcurl_1.9.1_linux_x86_64.tar.gz \
  | tar -xz -C ~/.local/bin \
  && chmod +x ~/.local/bin/grpcurl

# Add local bin to PATH
ENV PATH="/home/vscode/.local/bin:${PATH}"
